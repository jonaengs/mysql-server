--echo #########################################################################
--echo # START SET MANUAL HISTOGRAM
--echo #########################################################################

--echo # CREATE TABLE
CREATE TABLE twitter(j JSON);


--echo # INSERT DATA
INSERT INTO twitter VALUES('{"user": {"followers_count": 10}}');



ANALYZE TABLE twitter UPDATE HISTOGRAM ON j
USING DATA '{
  "buckets": [
    [
      "base64:type254:dXNlcl9vYmouZm9sbG93ZXJzX2NvdW50X251bQ==",
      1.0, 0.0,
      0, 152834, 1736,
      {
        "type": "equi-height",
        "buckets": [
          [13, 0.041061780596664314, 14],
          [22, 0.04388066713648109, 9],
          [31, 0.042142353770260745, 9],
          [39, 0.0411087620389946, 8],
          [49, 0.0447733145407564, 10],
          [57, 0.044538407329105, 8],
          [69, 0.04007517030772845, 12],
          [82, 0.040310077519379844, 13],
          [99, 0.04148461357763683, 17],
          [119, 0.044538407329105, 20],
          [136, 0.041531595019967116, 17],
          [156, 0.040498003288700964, 20],
          [179, 0.040122151750058725, 23],
          [202, 0.04040404040404041, 23],
          [232, 0.04054498473103124, 30],
          [265, 0.04059196617336152, 33],
          [302, 0.04068592905802208, 37],
          [343, 0.040498003288700964, 41],
          [413, 0.040638947615691805, 70],
          [497, 0.040498003288700964, 83],
          [632, 0.040169133192389, 130],
          [877, 0.040169133192389, 195],
          [1353, 0.04002818886539817, 291],
          [4904, 0.04007517030772845, 463],
          [152834, 0.009631195677707306, 160]
        ]
      }
    ]
  ],
  "histogram-type": "json-flex",
  "data-type": "json",
  "null-values": 0.0,
  "last-updated": "2023-02-27 16:13:14.0",
  "number-of-buckets-specified": 1024,
  "collation-id": 255,
  "sampling-rate": 0.0
}';

# SELECT * FROM information_schema.column_statistics WHERE TABLE_NAME = 'twitter' AND COLUMN_NAME = 'j';
SET OPTIMIZER_TRACE = "enabled=on";
--echo
--echo 
--echo 
EXPLAIN SELECT * FROM twitter WHERE j->>"$user.followers_count" > 10;
SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
