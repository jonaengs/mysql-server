--echo #########################################################################
--echo # START SET MANUAL HISTOGRAM
--echo #########################################################################

--echo # CREATE TABLE
CREATE TABLE region(jr json);


--echo # INSERT DATA
INSERT INTO region VALUES('{"r_name": "AFRICA", "r_comment": "lar deposits.", "r_regionkey": 0}');
INSERT INTO region VALUES('{"r_name": "AMERICA", "r_comment": "hs use ironic,", "r_regionkey": 1}');
INSERT INTO region VALUES('{"r_name": "ASIA", "r_comment": "ges. thinly even", "r_regionkey": 2}');
INSERT INTO region VALUES('{"r_name": "EUROPE", "r_comment": "ly final courts ", "r_regionkey": 3}');
INSERT INTO region VALUES('{"r_name": "MIDDLE EAST", "r_comment": "uickly special", "r_regionkey": 4}');



ANALYZE TABLE region UPDATE HISTOGRAM ON jr 
USING DATA '{
  "buckets": [
    [
      "base64:type254:aXNfYm9vbA==",
      1.0,
      0.0,
      false,
      true,
      2,
      {
        "type": "singleton",
        "buckets": [
          [false, 0.03],
          [true, 0.97]
        ]
      }
    ],
    [
      "base64:type254:aWRfbnVt",
      1.0,
      0.0,
      421040281296052225,
      433266515216179202,
      21285
    ],
    [
      "base64:type254:c291cmNlX3N0cg==",
      1.0,
      0.0,
      "base64:type254:PGEgaHJlZj0iaHR0cDovL2JlZ3dhcmUuYml6IiByZWw9Im5vZm9sbG93Ij5iZWdSZXR3ZWV0PC9hPg==",
      "base64:type254:d2Vi",
      37,
      {
        "type": "singleton",
        "buckets": [
          [
            "base64:type254:PGEgaHJlZj0iaHR0cDovL3d3dy5hcHBsZS5jb20iIHJlbD0ibm9mb2xsb3ciPmlPUzwvYT4=",
            0.8906272022551093
          ],
          [
            "base64:type254:PGEgaHJlZj0iaHR0cDovL2l0dW5lcy5hcHBsZS5jb20vdXMvYXBwL2ltZGItbW92aWVzLXR2L2lkMzQyNzkyNTI1P210PTgmdW89NCIgcmVsPSJub2ZvbGxvdyI+SU1EYiBNb3ZpZXMgJiBUViBvbiBpT1M8L2E+",
            0.08531829927178765
          ]
        ],
        "rest_frequency": 0.0006872713849458036
      }
    ],
    [
      "base64:type254:dHJ1bmNhdGVkX2Jvb2w=",
      1.0,
      0.0,
      false,
      false,
      1
    ],
    [
      "base64:type254:cl9yZWdpb25rZXlfbnVt",
      1.0, 0.0, 0, 4, 5,
      {
        "type": "singleton",
        "buckets": [[0, 0.2],[1, 0.2],[2, 0.2],[3, 0.2],[4, 0.2]],
        "rest_frequency": 0.01
      }
    ],
    [
      "base64:type254:cl9uYW1l",
      1.0, 0.0
    ],
    [
      "base64:type254:cl9uYW1lX3N0cg==",
      1.0, 0.0, "base64:type254:QUZSSUNB", "base64:type254:TUlERExFIEVBU1Q=", 5,
      {
        "type": "singleton",
        "buckets": [["base64:type254:QUZSSUNB", 0.2], ["base64:type254:QU1FUklDQQ==", 0.2], ["base64:type254:QVNJQQ==", 0.2], ["base64:type254:RVVST1BF", 0.2], ["base64:type254:TUlERExFIEVBU1Q=", 0.2]]
      }
    ],
    [
      "base64:type254:cl9jb21tZW50",
      1.0,
      0.0
    ],
    [
      "base64:type254:cl9jb21tZW50X3N0cg==",
      1.0,
      0.0,
      "base64:type254:Z2VzLiB0aGlubHkgZXZlbiBwaW50byBiZWFucyBjYQ==",
      "base64:type254:dWlja2x5IHNwZWNpYWwgYWNjb3VudHMgY2Fqb2xlIGNhcmVmdWxseSBibGl0aGVseSBjbG9zZSByZXF1ZXN0cy4gY2FyZWZ1bGx5IGZpbmFsIGFzeW1wdG90ZXMgaGFnZ2xlIGZ1cmlvdXNs",
      5
    ]
  ],
  "histogram-type": "json-flex",
  "data-type": "json",
  "null-values": 0.0,
  "last-updated": "2023-02-27 16:13:14.0",
  "number-of-buckets-specified": 1024,
  "collation-id": 255,
  "sampling-rate": 0.0
}';

SET OPTIMIZER_TRACE = "enabled=on";
--echo
--echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_regionkey" BETWEEN 1 AND 3;
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_regionkey" BETWEEN 5 AND 10;
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "AFRICA" AND "MIDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "EUROPE" AND "MYDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "EUROPE" AND "MEDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "EYROPE" AND "MEDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "EYROPE" AND "MIDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" BETWEEN "EUROPE" AND "MIDDLE EAST";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.r_regionkey" IN (1, 6);
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# --echo 
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.source" = "<a href=\"http://www.apple.com\" rel=\"nofollow\">iOS</a>";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
# --echo 
# EXPLAIN SELECT * FROM region WHERE jr->>"$.source" = "asdasd";
# SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
--echo 
--echo 
--echo 
EXPLAIN SELECT * FROM region WHERE jr->>"$.is" = TRUE;
SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
--echo 
EXPLAIN SELECT * FROM region WHERE jr->>"$.is" IS TRUE;
SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
--echo 
EXPLAIN SELECT * FROM region WHERE jr->>"$.is" = FALSE;
SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
--echo 
--echo 
--echo 

#SELECT * FROM region;
#--echo 
#--echo 
#--echo 
#SELECT * FROM information_schema.column_statistics WHERE TABLE_NAME = 'region' AND COLUMN_NAME = 'jr';
#--echo 
#--echo 
#--echo 
#EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" = "ASIA";
#SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect[0][0][0].histogram_selectivity") AS SELECTIVITY FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;
#--echo 
#--echo 
#--echo 
#EXPLAIN SELECT * FROM region WHERE jr->>"$.r_name" = "ASIA" AND jr->>"$.r_regionkey" = 2;
#SELECT JSON_EXTRACT(TRACE, "$**.filtering_effect") FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;